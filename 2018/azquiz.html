<style>
body,html{
padding:0;
margin:0;
font-family:'Segoe UI', sans-serif;
}
</style>
<canvas id="c" width="900" height="700">
</canvas>
<div style="z-index:10;left:20;top:20;position:absolute;font-size:40px;cursor:pointer;" id="bride">Petra<div class="sum"></div></div>
<div style="z-index:10;right:20;top:20;position:absolute;font-size:40px;cursor:pointer;" id="groom">Martin<div class="sum"></div></div>
<script>
window.addEventListener("load",e=>{
	var ctx = document.getElementById("c").getContext("2d");
	var step = 0;
	var guesses = {"bride":[], "groom":[]};
	var player = "";
	var grid = [];
	var rewards = {"bride":[900, 600, 1200 ], "groom":[800, 1500, 2000]};
	var running = true;
	setInterval(e=>{step = running ? (step+1)%28 : step},300);
	function hexa(x,y,r,color){
		ctx.beginPath();
		ctx.moveTo(x,y+r);
		for(var i=1;i<6;i++){
			ctx.lineTo(x+Math.sin(Math.PI/3*i)*r,y+Math.cos(Math.PI/3*i)*r);
		}

		ctx.closePath();
		ctx.stroke();
		ctx.fillStyle=color;
		ctx.fill();
	}

	function label(text, x, y, r) {
		ctx.fillStyle="rgba(255,255,255,1)";
		var w = ctx.measureText(text).width;
		ctx.fillText(text, x-.5*w, y+r*.1);
	}

	function paint(){
		ctx.fillStyle="rgba(255,255,255,1)";
		ctx.fillRect(0,0,10000,100000);
		var r= window.innerHeight / 16;
		for(var i=0;player && i<8;i++){
			for(var j=0;j<i;j++){
				var current = i*(i-1)/2 +j;
				var color = step == current ? "rgba(128,128,128,1)" : "rgba(200,200,200,1)";
				var x = window.innerWidth*.5 +(j-0.5*i)*r*1.1*Math.sqrt(3);
				var y = i*r*1.1*Math.sqrt(3);
				var hit = guesses[player].indexOf(current);
				if (hit >= 0) {
					color="rgba(64,64,64)";
					ctx.font="bold "+(.6*r)+"px 'Segoe UI',Calibri";
					hexa(x, y,r, color);
					label(rewards[player][hit], x, y, r);
					
				} else {
					hexa(x, y,r, color);
					if(guesses[player].length == 3){
						label(grid[current], x, y, r);
					}
				}
			}
		}
		requestAnimationFrame(paint);
	}

	requestAnimationFrame(paint);

	window.addEventListener("keyup",e=>{
		if(e.keyCode == 32){
			if(running && guesses[player] && guesses[player].length < 3){
				guesses[player].push(step);
				console.log(guesses);
				running = false;
				if(guesses[player].length < 3){
					setTimeout(e=>{running = true}, 2000);
				}
			}
			
		}
	});

	function resizeCanvas(){
		document.getElementById("c").width=window.innerWidth;
		document.getElementById("c").height=window.innerHeight;
	}

	resizeCanvas();
	window.addEventListener("resize",resizeCanvas);
	["bride","groom"].every(id=>{
		console.log(document.getElementById(id));
		document.getElementById(id).addEventListener("click", e=> {
			for(var i = 0;i<28;i++){
				grid[i] = Math.round(1+Math.random()*19)*100;
			}
			document.getElementById(id).style.color = "green";
			player= id;
			step=0;
			running=true;});
		return true;
	});
});
</script>